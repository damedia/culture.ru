{% extends ':Frontend:layout_two_column.html.twig' %}

{#--------------------------------------------------------------------------------------------------------------------#}
{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/jquery.ui.selectgroup.css') }}">
{% endblock %}

{#--------------------------------------------------------------------------------------------------------------------#}
{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('vendor/jquery.ui.selectgroup.js') }}"></script>
    <script src="{{ asset('vendor/jquery.form.js') }}"></script>
    <script>
        $(function(){
            // При выборе типа видосов, подгружаем список категорий
            // НЕ РАБОТАЕТ!
            $('#form_supertype').on('change', function(){
                console.log('xxx', $(this).val());
            });

            $('.ui-selectgroup-list li a').live('click', function(){

                console.log( $(this).closest('.ui-selectgroup-list').attr('aria-labelledby') );
                console.log( $(this).data('value') );
            });

            // Ajax Form handler
            $('#lectures-filter').ajaxForm({
                success: function(responseText, statusText, xhr, $form) {
                    var jsonData = $.parseJSON(responseText);

                    if ($('#lectures-filter').data('mode') == 'append') {
                        $('#lecture-container').append( jsonData.html );
                    } else {
                        $('#lecture-container').html( jsonData.html );
                    }

                    var loadedCount = $('#lecture-container .plitka-one-wrap').length;

                    if (loadedCount >= jsonData.total) {
                        $('#lecture-more-container').hide();
                    } else {
                        $('#lecture-more-container').show();
                    }
                }
            });

            // Form submit
            $('#lectures-filter-submit').click(function(){
                $('#lectures-filter').data('mode', 'replace');
                $('#form_page').val(1);
                $('#lectures-filter').submit();
                return false;
            });

            // Кнопка "ПОКАЗАТЬ ЕЩЕ ФИЛЬМЫ"
            $('#lecture-more-button').click(function(){
                var nextPage = parseInt($('#form_page').val()) + 1;
                $('#form_page').val(nextPage);
                $('#lectures-filter').data('mode', 'append');
                $('#lectures-filter').submit();
                return false;
            });
        });
    </script>
{% endblock %}

{#--------------------------------------------------------------------------------------------------------------------#}
{% block page_header %}
    <h1>Кинозал</h1>
    <div class="search-panel">
        <div class="search-category">

            <form id="lectures-filter" action="{{ path('armd_lecture_default_list') }}" method="post" {{ form_enctype(form) }}>
                <span class="search-dates-label">Выбрать</span>
                <div class="search-category-selects">
                    {{ form_widget(form.supertype, { 'attr': {'class': 'uni'} }) }}
                    {{ form_widget(form.genre, { 'attr': {'class': 'uni'} }) }}
                    <div style="display: none;">
                        {{ form_widget(form.theme, { 'attr': {'class': 'uni'} }) }}
                        {{ form_rest(form) }}
                    </div>
                </div>
                <button id="lectures-filter-submit" type="submit" class="button search-dates-button">Показать</button>
            </form>

        </div>
        <div class="search-top clearfix">
            <form action="">
                <input type="text" name="search-txt" placeholder="Поиск по сайту" class="search-txt" id="search-txt" />
                <input type="submit" value="Поиск" class="button search-btn" />
            </form>
            <div class="search-checkboxes">
                <label><input type="checkbox" name="check1" id="check1" /><span>Искать в текущем разделе</span></label>
            </div>
        </div>
    </div>
{% endblock %}

{#--------------------------------------------------------------------------------------------------------------------#}
{% block left_column %}
    {% if lectures|length > 0 %}
        <div id="lecture-container" class="plitka">
            {% include "ArmdLectureBundle:Default:plitka_one_wrap.html.twig" %}
        </div>
        <div id="lecture-more-container" class="more more2">
            <p><a id="lecture-more-button" href="{{ path('armd_lecture_default_list', { 'page':2 }) }}">Показать еще фильмы</a></p>
        </div>
    {% else %}
        <strong>По Вашему запросу объектов не найдено</strong>
    {% endif %}

    {# render 'ArmdLectureBundle:Default:lectureList' with {'lectureSuperTypeCode': lectureSuperType.code, 'page': page, 'types': 'all', 'categories': 'all'} #}
{% endblock %}

{#--------------------------------------------------------------------------------------------------------------------#}
{% block right_column %}

    {% render 'ArmdNewsBundle:News:memorialEvents' %}

    {% render 'ArmdAtlasBundle:Default:relatedObjects' with {'tags': {}, 'limit': 1} %}

    <div class="right-video-block">
        {% render 'ArmdLectureBundle:Default:relatedLectures' with {'tags': {}, 'limit':4, 'superTypeCode': 'LECTURE_SUPER_TYPE_CINEMA' } %}

        {% render 'ArmdLectureBundle:Default:relatedLectures' with {'tags': {}, 'limit': 4, 'superTypeCode': 'LECTURE_SUPER_TYPE_LECTURE' } %}
    </div>

{% endblock %}
