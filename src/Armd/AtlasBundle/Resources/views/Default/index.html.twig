{% extends ':Frontend:layout_one_column.html.twig' %}

{% block page_header_title %}
    {{ "atlas.atlas"|trans }}
{% endblock %}

{% block page_header_search %}
    <div class="search-category">
        <div id="regions-selector" class="regions-selector">
            <select data-placeholder="{{ "atlas.choose_region"|trans }}" class="chzn-select">
                <option></option>
                {% for region in regions %}
                    <option value="{{ region.id }}">{{ region.title }}</option>
                {% endfor %}
            </select>
        </div>
    </div>
{% endblock %}

{# ------------------------------------------------------------------------ #}
{% block one_column %}
    <ul class="breadcrumbs">
        <li><a href="{{ path('armd_main_homepage') }}">{{ 'menu.mainpage'|trans }}</a></li>
        <li><span>{{ 'menu.atlas'|trans }}</span></li>
    </ul>

    <div class="blocksection w {% if is_granted("IS_AUTHENTICATED_REMEMBERED") %}logged-in{% endif %}" id="map-section">
        <div class="filter checks-filter sidebar">

            <form id="atlas-filter-form" class="atlas-filter-form" action="{{ path('armd_atlas_default_filter') }}" method="POST">

                <input id="category-id" type="hidden" name="category" value="">
                <input id="filter-type" type="hidden" name="filter_type" value="">

                <div class="simple-search">
                    <input type="text" class="ss-input" id="ss_input" placeholder="{{ "atlas.address"|trans }}"/>
                </div>
                
                <div id="ajax-filter-tabs" class="ajax-filter-tabs">
                    {% render url('armd_atlas_ajax_filters', {'typeTab': 'filter_culture_objects' }) %}
                </div>
                <div class="filter-tabs">
                    {# 
                    <ul class="filter-tabs-titles">
                        <li class="active"><a href="#obj">{{ "atlas.objects"|trans }}</a></li>
                        <li class=""><a href="#maps">{{ "atlas.my_map"|trans }}</a></li>
                    </ul>
                    #}
                    {# Блок, который был на этом месте перенесен в шаблон src\Armd\AtlasBundle\Resources\views\Default\ajax_filter.html.twig #}
                    {#
                    <div class="filter-tab" id="mrsh">
                        <!-- маршруты -->
                    </div>
                    #}
                     
                    <div class="filter-tab" id="maps">
                        {% if is_granted("IS_AUTHENTICATED_REMEMBERED") %}
                            <!-- мои карты -->
                            <div class="filter-sub-tabs">
                                {#<ul class="filter-sub-tabs-titles">
                                    <li class="active"><a href="#myobj">Мои объекты</a></li>
                                    <li><a href="#mymrsh">Мои маршруты</a></li>
                                </ul>#}
                                <div class="filter-sub-tab" id="myobj" style="display:block;">
                                    <ol class="filter-sub-tab-list" id="myobj_list">
                                        {#<li>
                                            <span>Новый объект</span>
                                            <a href="#" class="del" title="Удалить"></a>
                                            <span class="moder"></span>
                                        </li>#}
                                    </ol>

                                    <!-- template -->
                                    <script id="myobj_list_template" type="text/x-jquery-tmpl">
                                        <li data-id="${id}">
                                            <span>${title}</span>
                                            <a class="del" href="#" title="{{ "atlas.delete"|trans }}"></a>
                                            <div class="moder status${status}" title="${statusTitle}" data-reason="${reason}">
                                                <span>${status}</span>
                                            </div>
                                            {#<ins class="edit"></ins>#}
                                        </li>
                                    </script>
                                    <!-- /template -->

                                    <input id="atlas-objects-add" type="button" class="button green-button" value="{{ "atlas.object.add"|trans }}" />

                                    <div id="atlas-objects-add-hint">{{ "atlas.click_map"|trans }}</div>
                                </div>
                                <div class="filter-sub-tab" id="mymrsh">

                                </div>
                            </div>
                        {% else %}
                            <div class="auth-required-msg">
                                {{ "atlas.auth_required"|trans({ '%loginUrl%':path("fos_user_security_login"), '%registerUrl%':path("fos_user_registration_register") })|raw }}
                            </div>
                        {% endif %}
                    </div>
                </div>

            </form>
        </div>
        <div class="atlas-center">
            <div class="sort-filter sort-element-filter">
                <a id="filter_culture_objects" href="#" class="atlas-tab-filters active">{{ "atlas.culture_objects"|trans }}</a>
                <a id="filter_tourist_clusters" href="#" class="atlas-tab-filters">{{ "atlas.tourist_clusters"|trans }}</a>
            </div>
            <div class="clear"></div>
            <div class="atlas-map">
                <div class="bar bar-top"></div>
                <div class="bar bar-right"></div>
                <div class="bar bar-bottom"></div>
                <div class="bar bar-left"></div>
                <div id="map"></div>
                <div id="ajax-loading" class="ajax-loading"></div>
            </div>
        </div>
    </div>

    <!-- popups -------------------------------------------- -->

    <!-- object form popup -->
    <div class="add-object-form draggable add" id="add-object-form">
        <a href="#" class="exit" title="Закрыть"></a>
        <form action="{{ path('armd_atlas_default_objectsadd') }}" method="POST">
            <h2 class="add">{{ "atlas.object.add"|trans }}</h2>
            <h2 class="edit">{{ "atlas.object.edit"|trans }}</h2>
            <input id="object-id" type="hidden" name="id" value="">
            <ul class="add-object-form-fields">
                <li>
                    <label for="name">{{ "atlas.object.title"|trans }}</label>
                    <input name="title" type="text" value="" placeholder="" id="name" />
                </li>
                <li>
                    <label for="address">{{ "atlas.object.address"|trans }}</label>
                    <input name="address" type="text" value="" placeholder="" id="address" />
                </li>
                <li class="coords">
                    <div class="coords-block">
                        <label for="lat">{{ "atlas.object.latitude"|trans }}</label>
                        <input name="lat" type="text" value="" id="lat" />
                    </div>
                    <div class="coords-block last">
                        <label for="lon">{{ "atlas.object.longitude"|trans }}</label>
                        <input name="lon" type="text" value="" id="lon" />
                    </div>
                </li>
                <li>
                    <label for="descr">{{ "atlas.object.description"|trans }}</label>
                    <textarea name="description" id="descr" cols="30" rows="10"></textarea>
                </li>
                <li>
                    <label for="category">{{ "atlas.object.category"|trans }}</label>
                    <select id="primary-category" name="primary_category" class="chzn-select" data-placeholder="{{ "atlas.object.choose_category"|trans }}" style="width:298px">
                        <option value=""></option>
                        {% for optgroup in categories if optgroup.title=='Object Type' or optgroup.title=='Тип объекта' %}
                            {% for tag in optgroup.tags if tag.hasIcon %}
                                <option value="{{ tag.id }}">{{ tag.title }}</option>
                            {% endfor %}
                        {% endfor %}
                    </select>
                </li>
                <li>
                    <label for="category">{{ "atlas.object.additional_tags"|trans }}</label>
                    <select id="category" name="category[]" class="chzn-select" multiple="multiple" data-placeholder="{{ "atlas.object.choose_category"|trans }}" style="width:298px">
                        <option value=""></option>
                        {% for optgroup in categories %}
                            <optgroup label="{{ optgroup.title }}">
                                {% for tag in optgroup.tags %}
                                    <option value="{{ tag.id }}">{{ tag.title }}</option>
                                {% endfor %}
                            </optgroup>
                        {% endfor %}
                    </select>
                </li>
                <li class="add-photos">
                    <div id="file-uploader"></div>
                    <div class="added-images">
                    </div>
                    <!-- template for .added-images -->
                    <script id="added-image-template" type="text/x-jquery-tmpl">
                        <div class="added-image" data-id="${id}">
                            <div class="image-wrapper"><img src="${imageUrl}" alt=""/></div>
                            <ins class="del" title="{{ "atlas.delete"|trans }}"></ins>
                            <input type="hidden" name="media[]" value="${id}">
                        </div>
                    </script>
                    <!-- /template for .added-images -->
                </li>
            </ul>
            <fieldset class="form-buttons">
                <input type="submit" class="button sbmt-btn" value="{{ "atlas.save"|trans }}"  />
                <input type="reset" class="button rst-btn" value="{{ "atlas.cancel"|trans }}"  />
            </fieldset>
        </form>
    </div>
    <!-- /object form popup -->

    <!-- success add popup -->
    <div class="add-object-form success-object-form draggable" id="success-object-form" >
        <a href="#" class="exit" title="{{ "atlas.alert.close"|trans }}"></a>
        <form action="{{ path('armd_atlas_default_objectmakepublic') }}" method="POST">
            <input class="object-id" name="id" type="hidden"/>
            <h2>{{ "atlas.alert.successfully_complete"|trans }}</h2>
            <div class="section-add">
                <p>{{ "atlas.alert.object_created"|trans|raw }}</p>
                <label class="sof-check"><input name="is_public" type="checkbox" />{{ "atlas.alert.add_to_map"|trans }}</label>
            </div>
            <div class="section-edit">
                <p>{{ "atlas.alert.changes_saved"|trans }}</p>
                <label class="sof-check"><input name="is_public" type="checkbox" checked="checked"/>{{ "atlas.alert.send_to_map"|trans }}</label>
            </div>
            <p class="note">{{ "atlas.alert.will_available"|trans }}</p>
            <fieldset class="form-buttons">
                <input type="submit" class="button sbmt-btn" value="{{ "atlas.alert.complete"|trans }}"  />
            </fieldset>
        </form>
    </div>
    <!-- /success add popup -->

    <!-- moderation request popup -->
    <div class="add-object-form moderation-object-form draggable" id="moderation-object-form">
        <a href="#" class="exit" title="{{ "atlas.alert.close"|trans }}"></a>
        <form action="{{ path('armd_atlas_default_objectmakepublic') }}" method="POST">
            <input id="moderation-object-id" class="object-id" name="id" type="hidden"/>
            <input type="hidden" name="is_public" value="on">
            <h2>{{ "atlas.alert.want_to_send"|trans }}</h2>
            <p class="note">{{ "atlas.alert.will_available"|trans|raw }}</p>
            <fieldset class="form-buttons">
                <input type="submit" class="button sbmt-btn" value="{{ "atlas.yes"|trans }}"/>
                <input type="reset" class="button rst-btn" value="{{ "atlas.later"|trans }}"/>
            </fieldset>
        </form>
    </div>
    <div class="add-object-form moderation-object-form draggable" id="moderation-object-form-1">
        <a href="#" class="exit" title="{{ "atlas.alert.close"|trans }}"></a>
        <div>
            <h2>{{ "atlas.alert.waiting_moderation"|trans }}</h2>
            <p class="note">{{ "atlas.alert.will_available"|trans|raw }}</p>
            <fieldset class="form-buttons">
                <input type="submit" class="button rst-btn" value="{{ "atlas.alert.close"|trans }}"/>
            </fieldset>
        </div>
    </div>
    <div class="add-object-form moderation-object-form draggable" id="moderation-object-form-2">
        <a href="#" class="exit" title="{{ "atlas.alert.close"|trans }}"></a>
        <div>
            <h2>{{ "atlas.alert.successfully_added"|trans }}</h2>
            <p class="note">{{ "atlas.alert.approved"|trans|raw }}</p>
            <fieldset class="form-buttons">
                <input type="submit" class="button rst-btn" value="{{ "atlas.alert.close"|trans }}"/>
            </fieldset>
        </div>
    </div>
    <div class="add-object-form moderation-object-form draggable" id="moderation-object-form-3">
        <a href="#" class="exit" title="{{ "atlas.alert.close"|trans }}"></a>
        <div>
            <h2>{{ "atlas.alert.rejected_warning"|trans }}</h2>
            <p class="note">{{ "atlas.alert.rejected_message"|trans|raw }}</p>
            <fieldset class="form-buttons">
                <input type="submit" class="button rst-btn" value="{{ "atlas.alert.close"|trans }}"/>
            </fieldset>
        </div>
    </div>
    <!-- /moderation request popup -->

    <!-- /popups -------------------------------------------- -->

    <!-- /Асинхронная загрузка jsapi -->
    <div id="script_block" class="script_block"></div>
    <div id="script_ad" class="script_ad" style="display:none;">
        <script type="text/javascript" charset="utf-8" src="http://js.tmcrussia.com/?{{ progorod_api_key }}&version=0.1.8"></script>
        {#<script type="text/javascript" charset="utf-8" src="http://jsapi.murzina.jsdev.tmcrussia.com/?{{ progorod_api_key }}&version=0.1.8"></script>#}
    </div>
    <script type="text/javascript">
        document.getElementById('script_block').appendChild(document.getElementById('script_ad'));
        document.getElementById('script_ad').style.display = 'block';
    </script>
    <!-- /Асинхронная загрузка jsapi -->

{% endblock %}

{# ------------------------------------------------------------------------ #}
{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('vendor/chosen/chosen.css') }}">
    <link rel="stylesheet" href="{{ asset('vendor/select2/select2.css') }}">
    <link rel="stylesheet" href="{{ asset('vendor/valums-file-uploader/client/fileuploader.css') }}">
    <link rel="stylesheet" href="{{ asset('bundles/armdatlas/css/atlas_new.css') }}">
{% endblock %}

{# ------------------------------------------------------------------------ #}
{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('vendor/jquery.form.js') }}"></script>
    <script type="text/javascript" src="{{ asset('vendor/jquery.tmpl.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('vendor/jquery.cookie.js') }}"></script>
    <script type="text/javascript" src="{{ asset('vendor/chosen/chosen.jquery.js') }}"></script>
    <script type="text/javascript" src="{{ asset('vendor/select2/select2.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('vendor/valums-file-uploader/client/fileuploader.js') }}"></script>
    <script type="text/javascript" src="{{ asset('vendor/jquery.uniform.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('vendor/fancybox/jquery.fancybox.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/armdatlas/js/atlas_new.js') }}"></script>
    <script type="text/javascript">
        $(function(){
            AT.init({
                map: 'map',
                center: [55,56],
                zoom: 4,
                leftLon: 10,
                rightLon: -190,
                fetchMarkersUri:       '{{ path('armd_atlas_default_filter') }}',
                fetchMarkerDetailUri:  '{{ path('armd_atlas_default_objectballoon') }}',
                fetchClusterDetailUri: '{{ path('armd_atlas_default_clusterballoon') }}',
                fetchMyObjectsUri:     '{{ path('armd_atlas_default_objectsmy') }}',
                deleteMyObjectsUri:    '{{ path('armd_atlas_default_objectsmydelete') }}',
                imageUploadUri:        '{{ path('armd_atlas_default_objectsmyupload') }}',
                bundleImagesUri:       '{{ asset('bundles/armdatlas/images') }}',
                locale:                '{{ app.request.locale }}'
            });
        });
    </script>
{% endblock %}
