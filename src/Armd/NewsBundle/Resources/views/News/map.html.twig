{% extends '::base.html.twig' %}

{# ------------------------------------------------------------------------ #}
{% block body %}

    <div class="blocksection w {% if is_granted("IS_AUTHENTICATED_REMEMBERED") %}logged-in{% endif %}" id="map-section">
        <div class="filter checks-filter" style="width:23.7%">
            <div class="title dark-green-title title-filter">
                <h2>{{ "newsmap.filter"|trans }}</h2>
            </div>

            <form id="news-map-filter" class="filter-form" action="{{ path('armd_news_filter') }}">
                <div class="simple-search">
                    <label for="ss_input">{{ "newsmap.find_address"|trans }}</label>
                    <input type="text" class="ss-input" id="ss_input" />
                </div>
                <div class="filter-tabs">
                    <div class="filter-tab" id="obj" style="display:block;">
                        <div class="simple-filter-block">
                            <div class="simple-filter-header clearfix">
                                <span>{{ "newsmap.event_type"|trans }}</span>
                                <p class="check_all"><span>{{ "atlas.all"|trans }}</span></p>
                            </div>
                            <div class="simple-filter-options">
                                {% for category in categories %}
                                    <label class="gray-checked checked">
                                        <input class="category-value" type="hidden" name="f[category][]" value="{{ category.id }}"/>
                                        <span data-tag="{{ category.id }}">{{ category.title }}</span>
                                    </label>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="simple-filter-block">
                            <div class="simple-filter-header clearfix">
                                <span>{{ "newsmap.date_range"|trans }}</span>
                            </div>
                            <div class="simple-filter-options">
                                <div class="date-range">
                                    <label>{{ "newsmap.date_from"|trans }}&nbsp;<input id="date-from" class="datepicker" type="text" name="f[date_from]" value="{{ dateFrom }}"/></label>
                                    <label>{{ "newsmap.date_to"|trans }}&nbsp;<input id="date-to" class="datepicker" type="text" name="f[date_to]" value="{{ dateTo }}"/></label>
                                </div>
                            </div>
                        </div>
                        <div class="simple-filter-block visualization">
                            <div class="simple-filter-header clearfix">
                                <span>{{ "newsmap.visualization"|trans }}</span>
                            </div>
                            <div class="simple-filter-options">
                                <label for="show-images">
                                    <input type="hidden" name="f[show_images]" value="0"/>
                                    <input id="show-images-checkbox" type="checkbox" name="f[show_images]" value="1"/>
                                    <span id="show-images-span">{{ "newsmap.show_as_photos"|trans }}</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="atlas-center">
            <div class="title green-title">
                <h2>{{ "newsmap.events_on_map"|trans }}</h2>
            </div>
            <div class="atlas-map" style="margin-top:-10px;">
                <div id="map"></div>
                <div id="regions-selector" class="regions-selector">
                    <select data-placeholder="{{ "atlas.choose_region"|trans }}" class="chzn-select">
                        <option></option>
                        {% for region in regions %}
                            <option value="{{ region.id }}">{{ region.title }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div id="ajax-loading" class="ajax-loading"></div>
            </div>

            {% if lastNews %}
                <div class="last-news">
                    <ul>
                        {% for entity in lastNews %}
                            <li>
                                {% if entity.image %}
                                    <div class="image">
                                        <a href="{{ path('armd_news_item_by_category', { category:entity.category.slug, id:entity.id }) }}">
                                            <img src="{% path entity.image, 'thumbnail' %}" />
                                        </a>
                                    </div>
                                {% endif %}
                                <div class="content">
                                    <div class="caption">
                                        <a href="{{ path('armd_news_item_by_category', { category:entity.category.slug, id:entity.id }) }}">
                                            {{ entity.title|raw }}
                                        </a>
                                    </div>
                                    <div class="text">{{ entity.announce|raw }}</div>
                                    <div class="date">
                                        {{ "newsmap.date"|trans }}:
                                        {{ entity.date|date('d.m.Y') }}
                                        {% if entity.endDate %}&mdash;&nbsp;{{ entity.endDate|date('d.m.Y') }}{% endif %}
                                    </div>
                                    <div class="category">
                                        {{ "newsmap.category"|trans }}:
                                        {{ entity.category.title }}
                                    </div>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- /Асинхронная загрузка jsapi -->
    <div id="script_block" class="script_block"></div>
    <div id="script_ad" class="script_ad" style="display:none;">
        <script type="text/javascript" charset="utf-8" src="http://js.tmcrussia.com/?{{ progorod_api_key }}&version=0.1.8"></script>
        {#<script type="text/javascript" charset="utf-8" src="http://jsapi.murzina.jsdev.tmcrussia.com/?{{ progorod_api_key }}&version=0.1.8"></script>#}
    </div>
    <script type="text/javascript">
        document.getElementById('script_block').appendChild(document.getElementById('script_ad'));
        document.getElementById('script_ad').style.display = 'block';
    </script>
    <!-- /Асинхронная загрузка jsapi -->
{% endblock %}

{# ------------------------------------------------------------------------ #}
{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/jquery-ui-1.8.21.custom.css') }}">
    <link rel="stylesheet" href="{{ asset('bundles/armdatlas/css/chosen.css') }}">
    <link rel="stylesheet" href="{{ asset('bundles/armdatlas/js/ivaynberg-select2/select2.css') }}">
    <link rel="stylesheet" href="{{ asset('bundles/armdnews/css/news_map.css') }}">
{% endblock %}

{# ------------------------------------------------------------------------ #}
{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('js/libs/jquery-ui-1.8.22.custom.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/armdatlas/js/jquery.form.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/armdatlas/js/chosen.jquery.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/armdatlas/js/ivaynberg-select2/select2.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/armdnews/js/news_map.js') }}"></script>
    <script type="text/javascript">
        $(function(){
            AT.init({
                map: 'map',
                center: [55,56],
                zoom: 4,
                fetchMarkerDetailUri:  '{{ path('armd_news_map_balloon') }}',
                locale:                '{{ app.request.locale }}'
            });
            AT.submitFiltersForm();
        });
    </script>
{% endblock %}
