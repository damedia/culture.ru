{% extends ':Frontend:layout_two_column.html.twig' %}

{% block title %}{{ "News Widget"|trans }} &mdash; {{ parent() }}{% endblock %}

{% import 'ArmdNewsBundle::date_macro.html.twig' as armd_news %}

{% block page_header_title %}{{ "News Widget"|trans }}{% endblock %}

{% block left_column %}
    <h2>
        {{ "News Widget"|trans }}
    </h2>

    <div class="block">
        <h2 class="long-border"><span>Выбор параметров оформления</span></h2>
        <form id="news-widget-settings">
            <table>
                <tr>
                    <td>Ширина</td>
                    <td><input type="number" name="width" value="250" /></td>
                </tr>
                <tr>
                    <td>Высота</td>
                    <td><input type="number" name="height" value="250" /></td>
                </tr>
                <tr>
                    <td>Количество новостей</td>
                    <td>
                        <select name="count">
                            <option value="1">1</option>
                            <option value="3" selected="selected">3</option>
                            <option value="5">5</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>Прокрутка</td>
                    <td><input type="checkbox" name="overflow" checked="checked" /></td>
                </tr>
                <tr>
                    <td>Вывод изображений</td>
                    <td><input type="checkbox" name="images" /></td>
                </tr>
            </table>
        </form>

    </div>

    <div class="block">
        <h2 class="long-border"><span>Просмотр</span></h2>

        <div id="news-widget-preview"></div>
    </div>

    <div class="block" id="news-widget-code">
        <h2 class="long-border"><span>Код информера</span></h2>
        <textarea cols="50" rows="10"></textarea>
    </div>

</article>

{% endblock %}


{% block right_column %}
    {% render url('armd_news_memorial_events') %}
{% endblock %}


{% block stylesheets %}
    {{ parent() }}

    <style type="text/css">
        #news-widget-settings table {

        }
        #news-widget-settings table td {
            padding: 5px 5px 5px 0;
        }
        #news-widget-preview {
            padding: 5px 0;
        }
        #news-widget-code textarea {
            margin: 5px 0;
        }

        #culture-news-widget {
            border: 1px solid #e1e1e1;
            padding: 5px;
        }
        #culture-news-widget .culture-news-header {
            text-align: center;
        }
        #culture-news-widget .culture-news-header div {

        }
    </style>
{% endblock %}


{% block javascripts %}
    {{ parent() }}

    <script type="text/javascript">
        $(document).ready(function() {
            $('#news-widget-settings').change(function() {
                var formData = $('#news-widget-settings').serializeArray();

                var serializedArray2Object = function(a) {
                    var o = {};
                    $.each(a, function() {
                        if (o[this.name] !== undefined) {
                            if (!o[this.name].push) {
                                o[this.name] = [o[this.name]];
                            }
                            o[this.name].push(this.value || '');
                        } else {
                            o[this.name] = this.value || '';
                        }
                    });
                    return o;
                }

                formData = serializedArray2Object(formData);

                var widgetUrl = '{{ url('armd_news_widget') }}';



                var widgetCode = [
'<style type="text/css">',
'    #culture-news-widget .culture-news-image {',
('images' in formData) ? '' : '        display: none;',
'    }',
'    #culture-news-widget {',
'        background: transparent;',
'        height: ' + formData.height + 'px;',
'        width: ' + formData.width + 'px;',
('overflow' in formData) ? '        overflow-y: auto;' : '        overflow-y: visible;',
'    }',
'</style>',
'<script src="' + widgetUrl + '?count=' + formData.count + '" type="text/javascript"></' + 'script>',
'<div id="culture-news-widget"></div>'
                ].join("\n");

                $('#news-widget-code textarea').text(widgetCode);

                $('#news-widget-preview').html(widgetCode);

                $('#news-widget-code textarea').focus();

                return false;
            });

            // Raise...
            $('#news-widget-settings').change();
        });
    </script>

{% endblock %}
