<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
	<title>Insert title here</title>
	
	<link rel="stylesheet" href="{{ asset('js/jquery-ui-1.10.3/themes/base/jquery-ui.css') }}" />

	<script type="text/javascript" src="{{ asset('js/jquery/jquery.min.js') }}"></script>
	<script type="text/javascript" src="{{ asset('js/jquery-ui-1.10.3/jquery-ui.min.js') }}"></script>
</head>
<body>

<div class="ui-widget" style="width:100%">
  <label id="caption" for="tags">Поиск: </label>
  <input id="tags" style="width:100%" />
</div>

<script>
$(document).ready(function(){
	var inputCaption = $("#caption"),
        autocompleteInput = $("#tags"),
        availableTags = function(request, response){
    	    var searchTerm = request.term,
    		    entity = window.location.hash.substr(1);
            
	   	    $.ajax("{{ path('get_snippet_jsonlist') }}?_sonata_admin={{ admin.code }}&entity="+entity+"&q="+searchTerm, {
	   		    success: function(data){
	   			    if (data.length) {
	   				    autocompleteInput.removeClass("ui-state-error");
	   			    }
	   			    else {
	   				    autocompleteInput.addClass("ui-state-error");
	   			    }
	   			    
				    response(data);
			    },
			    error: function(xhr, err){
				    autocompleteInput.addClass("ui-state-error");
			    }
	   	    });
        },
        go = function(item){
            if (window.parent.modalEditor) {
                window.parent.modalEditor.callback({value: item.value, label:item.label});
            }
        };

    autocompleteInput.autocomplete({ "source": availableTags }).on("autocompleteselect", function(event, ui){
    	go(ui.item);
    });

    inputCaption.html("Поиск по разделу '"+window.location.hash.substr(1)+"'");
});
</script>

</body>
</html>